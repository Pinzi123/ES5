!function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=16)}([,,,,,,,,,,,,,,,,function(t,e,i){"use strict";function n(){$("#btn-start").on("click",function(t){$(".start-container").css("display","none"),$(".game-container").css("display","block"),$("#gamepad").css("display","block"),o()}),$("#btn-setting").on("click",function(t){alert("Setting")})}function o(){ResourceManager.onResourceLoaded=function(){(new r.default).startGame()},ResourceManager.init()}var s=i(17),r=function(t){return t&&t.__esModule?t:{default:t}}(s);i(23),i(24),i(25),i(26);var a=i(27),c=new a;(screen.width<481||window.screen.width<481)&&c.draw(),document.addEventListener("DOMContentLoaded",function(t){n()})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(18),a=n(r),c=i(22),h=n(c),u=function(){function t(){o(this,t),this.board=new a.default,new h.default(this.board).init()}return s(t,[{key:"startGame",value:function(){var t=this;window.TetrisConfig.intervalId=window.setInterval(function(){t.board.tick()},window.TetrisConfig.speed)}},{key:"endGame",value:function(){}}]),t}();t.exports=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(19),a=n(r),c=i(20),h=n(c),u=function(){function t(){o(this,t),this.blockSize=30,this.rows=20,this.cols=13,screen.width<481&&(this.blockSize=(.98*screen.width-80)/this.cols),this.canvas=new a.default("c_game_main",this.cols*this.blockSize,this.rows*this.blockSize),this.context=this.canvas.context,this.boardList=[],this.shape=new h.default,this._init()}return s(t,[{key:"_init",value:function(){this._buildGridData(),this._initGrid(),this.shape.draw(this.context,this.blockSize)}},{key:"_buildGridData",value:function(){for(var t=0;t<this.rows;t++){this.boardList[t]=[];for(var e=0;e<this.cols;e++)this.boardList[t][e]=0}}},{key:"_initGrid",value:function(){var t=void 0;for(this.context.strokeStyle="green",this.context.lineWidth=.5,t=0;t<this.rows;t++)this.context.moveTo(0,t*this.blockSize),this.context.lineTo(this.canvas.width,t*this.blockSize);for(t=0;t<this.rows;t++)this.context.moveTo(t*this.blockSize,0),this.context.lineTo(t*this.blockSize,this.canvas.height);this.context.stroke(),this.gridImageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height)}},{key:"tick",value:function(){this.validMove(0,1)?this.shape.y+=1:(this.addShapeToBoardList(),this.clearFullRows(),this.shape=new h.default),this.refresh(),this.shape.draw(this.context,this.blockSize)}},{key:"refresh",value:function(){this.canvas.clear(),this.context.putImageData(this.gridImageData,0,0),this.drawBlock()}},{key:"validMove",value:function(t,e){for(var i=this.shape.x+t,n=this.shape.y+e,o=0;o<this.shape.layout.length;o++)for(var s=0;s<this.shape.layout[o].length;s++)if(this.shape.layout[o][s]&&(void 0===this.boardList[n+o]||void 0===this.boardList[n+o][i+s]||this.boardList[n+o][i+s]||i+s<0||i+s>=this.cols||n+o>=this.rows))return!1;return!0}},{key:"addShapeToBoardList",value:function(){for(var t=0;t<this.shape.layout.length;t++)for(var e=0;e<this.shape.layout[t].length;e++)if(this.shape.layout[t][e]){var i=this.shape.x+e,n=this.shape.y+t;if(this.boardList[n][i])return;this.boardList[n][i]=this.shape.blockType}}},{key:"drawBlock",value:function(){for(var t=0;t<this.rows;t++)for(var e=0;e<this.cols;e++)this.boardList[t][e]&&this.shape.block.draw(this.context,e,t,this.boardList[t][e])}},{key:"clearFullRows",value:function(){console.log("this.boardList",this.boardList[0]);for(var t=new Array(this.cols).fill(0),e=this.rows-1;e>=0;e--){this.boardList[e].filter(function(t){return t>0}).length===this.cols&&e&&(console.log("小初一行"),this.boardList.splice(e,1),this.boardList.unshift(t))}}}]),t}();t.exports=u},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(e,i,o){if(n(this,t),this.canvasId=e,this.el=document.getElementById(e),!this.el)throw new Error("Must provider a right id.");this.context=this.el.getContext("2d"),this.width=i,this.height=o,this._init()}return o(t,[{key:"_init",value:function(){this.el.width=this.width,this.el.height=this.height}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.width,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.height;this.context.clearRect(t,e,i,n)}}]),t}();t.exports=s},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(21),r=function(t,e){return t+Math.floor(Math.random()*e)},a=[[[0,1,0],[1,1,1]],[[1,1,1,1]],[[1,1],[1,1]],[[0,1],[1,1],[1,0]],[[1,0],[1,1],[0,1]],[[1,0,1],[1,1,1]],[[0,1],[1,1]],[[1,1]],[[1,1],[1,0],[1,0]],[[1,1],[0,1],[0,1]]],c=7,h=function(){function t(){n(this,t),this.x=0,this.y=0,this.blockType=r(1,c),this.block=new s(this.blockType),this.layout=a[r(0,a.length)],this.oldlayout}return o(t,[{key:"draw",value:function(t,e){for(var i=0;i<this.layout.length;i++)for(var n=0;n<this.layout[i].length;n++)this.layout[i][n]&&this.block.draw(t,n+this.x,i+this.y,void 0,e)}},{key:"rotate",value:function(){this.oldlayout=this.layout;for(var t=[],e=0;e<this.layout[0].length;e++){t[e]=[];for(var i=0;i<this.layout.length;i++)t[e][i]=this.layout[this.layout.length-1-i][e]}this.layout=t,this._setLayout()}},{key:"_setLayout",value:function(){this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x+this.layout[0].length>TetrisConfig.cols&&(this.x=TetrisConfig.cols-this.layout[0].length),this.y+this.layout.length>TetrisConfig.rows&&(this.y=TetrisConfig.rows-this.layout.length)}},{key:"_returnLayout",value:function(){this.layout=this.oldlayout}}]),t}();t.exports=h},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(e){n(this,t),this.blockType=e,this.size=30,this.originalSize=32,this.sprite=window.ResourceManager.getResource("blocks")}return o(t,[{key:"draw",value:function(t,e,i,n,o){o=o||this.size,t.drawImage(this.sprite,((n||this.blockType)-1)*this.originalSize,0,this.originalSize,this.originalSize,e*o,i*o,o,o)}}]),t}();t.exports=s},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s={38:"top",39:"right",40:"down",37:"left"},r=function(){function t(e){n(this,t),this.board=e}return o(t,[{key:"init",value:function(){var t=this;document.addEventListener("keydown",function(e){t.processKeyDown(e)})}},{key:"processKeyDown",value:function(t){s[t.keyCode]&&this.press(s[t.keyCode])}},{key:"press",value:function(t){var e=!1;switch(t){case"top":this.board.shape.rotate(),this.board.validMove(0,0)?e=!0:this.board.shape._returnLayout();break;case"right":this.board.validMove(1,0)&&(this.board.shape.x+=1,e=!0);break;case"down":this.board.validMove(0,1)&&(this.board.shape.y+=1,e=!0);break;case"left":this.board.validMove(-1,0)&&(this.board.shape.x-=1,e=!0)}if(e&&(this.board.refresh(),this.board.shape.draw(this.board.context),"down"===t)){var i=this;window.clearInterval(window.TetrisConfig.intervalId),window.TetrisConfig.intervalId=window.setInterval(function(){i.board.tick()},window.TetrisConfig.speed)}}}]),t}();t.exports=r},function(t,e){},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t){function e(t){this.dom=t}e.prototype.get=function(){return this.dom},e.prototype.on=function(t,e){this.get().addEventListener(t,e)},e.prototype.css=function(t,e){this.get().style[t]=e},window.$=function(i,n){return console.log("selector",i),new e((n||t).querySelector(i))},console.log("ok");var i=function(t,e){var i=!0,n=!1,o=void 0;try{for(var s,r=Reflect.ownKeys(e)[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var a=s.value;if("constructor"!==a&&"prototype"!==a&&"name"!==a){var c=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,c)}}}catch(t){n=!0,o=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}};window.mix=function(){for(var t=function t(){n(this,t)},e=arguments.length,o=Array(e),s=0;s<e;s++)o[s]=arguments[s];var r=!0,a=!1,c=void 0;try{for(var h,u=o[Symbol.iterator]();!(r=(h=u.next()).done);r=!0){var l=h.value;i(t,l),i(t.prototype,l.prototype)}}catch(t){a=!0,c=t}finally{try{!r&&u.return&&u.return()}finally{if(a)throw c}}return t}}(document),CanvasRenderingContext2D.prototype.sector=function(t,e,i,n,o){return this.beginPath(),this.moveTo(t,e),this.arc(t,e,i,n,o),this.closePath(),this}},function(t,e,i){"use strict";!function(t){var e=new Map,i=0,n=function(){1===(i+=1)&&"function"==typeof t.ResourceManager.onResourceLoaded&&t.ResourceManager.onResourceLoaded()},o=function(){var t=new Image;t.onload=function(){e.set("blocks",t),n()},t.src="img/tetris/blocks.png"},s=function(t){return e.get(t)};t.ResourceManager={getResource:s,init:o,onResourceLoaded:null}}(window)},function(t,e,i){"use strict";!function(t){t.TetrisConfig={rows:20,cols:13,speed:500,constSpeed:1e3,intervalId:0,config:{}}}(window)},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(){n(this,t),this.can=document.getElementById("gamepad"),this.ctx=this.can.getContext("2d"),this.can.width=screen.width,this.w=this.can.width}return o(t,[{key:"draw",value:function(){this.ctx.save(),this.ctx.strokeStyle="#0000ff",this.ctx.sector(75,75,50,1.775*Math.PI,.225*Math.PI),this.ctx.stroke(),this.ctx.sector(75,75,50,.275*Math.PI,.725*Math.PI),this.ctx.stroke(),this.ctx.sector(75,75,50,.775*Math.PI,1.225*Math.PI),this.ctx.stroke(),this.ctx.sector(75,75,50,1.275*Math.PI,1.725*Math.PI),this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.fillStyle="#FF0000",this.ctx.beginPath(),this.ctx.arc(this.w-120,60,15,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.font="10px Georgia",this.ctx.fillText("Pause",this.w-100,65),this.ctx.restore(),this.ctx.save(),this.ctx.fillStyle="#0000ff",this.ctx.beginPath(),this.ctx.arc(this.w-80,100,15,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.font="10px Georgia",this.ctx.fillText("Setting",this.w-60,105),this.ctx.restore();var t=this;this.can.addEventListener("click",function(e){t.reDraw(t.getPosition(e))},!1)}},{key:"reDraw",value:function(t){var e=null;return this.ctx.save(),this.ctx.strokeStyle="#0000ff",this.ctx.sector(75,75,50,1.775*Math.PI,.225*Math.PI),this.ctx.isPointInPath(t.x,t.y)&&(e="right"),this.ctx.stroke(),this.ctx.sector(75,75,50,.275*Math.PI,.725*Math.PI),this.ctx.isPointInPath(t.x,t.y)&&(e="down"),this.ctx.stroke(),this.ctx.sector(75,75,50,.775*Math.PI,1.225*Math.PI),this.ctx.isPointInPath(t.x,t.y)&&(e="left"),this.ctx.stroke(),this.ctx.sector(75,75,50,1.275*Math.PI,1.725*Math.PI),this.ctx.isPointInPath(t.x,t.y)&&(e="up"),this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=0,this.ctx.beginPath(),this.ctx.arc(this.w-120,60,15,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.isPointInPath(t.x,t.y)&&(e="pause"),this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.strokeStyle="#0000ff",this.ctx.lineWidth=0,this.ctx.beginPath(),this.ctx.arc(this.w-80,100,15,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.isPointInPath(t.x,t.y)&&(e="setting"),this.ctx.stroke(),this.ctx.restore(),console.log(e),e}},{key:"getPosition",value:function(t){return{x:t.clientX-this.can.offsetLeft,y:t.clientY-this.can.offsetTop}}}]),t}();t.exports=s}]);